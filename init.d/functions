#!/bin/sh
# rcinit common routines

# Check status and print
# OK or FAIL
status_ok()
{
	if [ -z "$CROND" ] ; then
		printf "\\033[65G\\033[1;32mOK\\033[0;39m\n"
	else
		printf "  OK\n"
	fi
}

status_fail()
{
	if [ -z "$CROND" ] ; then
		printf "\\033[65G\\033[1;31mFAIL\\033[0;39m\n"
	else
		printf "  FAIL\n"
	fi
}

check_status()
{
	local ERR=$?
	if [ $ERR = 0 ]; then
		status_ok
	else
		status_fail
	fi
}

wait_for_pid()
{
	[ -z "$WAIT_DELAY" ] && WAIT_DELAY=10
	while [ $WAIT_DELAY -gt 0 ]; do
		case "$1" in
		"created")
			if [ -f "$2" ] ; then
				return 0
			fi
			;;
		"removed")
			if [ ! -f "$2" ] ; then
				return 0
			fi
			;;
		*)
			return 1
		esac
		sleep 1
		: $((WAIT_DELAY -= 1))
	done
	return 1
}
